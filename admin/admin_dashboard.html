<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - KidsStore</title>
  <link rel="stylesheet" href="../css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .product-thumb { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; }
    .action-btns { display: flex; gap: 0.5rem; }
    .modal-form .form-group { margin-bottom: 1rem; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="admin-layout">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
      <div class="logo">
        <i class="fas fa-baby"></i> Kids<span>Store</span>
        <small style="display: block; font-size: 0.7rem; opacity: 0.7;">Admin Panel</small>
      </div>
      <ul class="admin-nav">
        <li><a href="dashboard.html" class="active"><i class="fas fa-chart-line"></i> Dashboard</a></li>
        <li><a href="products.html"><i class="fas fa-box"></i> Products</a></li>
        <li><a href="orders.html"><i class="fas fa-shopping-bag"></i> Orders</a></li>
        <li><a href="#" onclick="adminLogout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
      </ul>
      <div style="margin-top: auto; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
        <a href="../index.html" style="color: var(--gray); font-size: 0.875rem;">
          <i class="fas fa-external-link-alt"></i> View Store
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
      <div class="admin-header">
        <h1>Dashboard</h1>
        <span style="color: var(--gray);">Welcome, Admin</span>
      </div>

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <h3>Total Products</h3>
          <p class="value" id="total-products">0</p>
        </div>
        <div class="stat-card">
          <h3>Total Orders</h3>
          <p class="value" id="total-orders">0</p>
        </div>
        <div class="stat-card">
          <h3>Total Revenue</h3>
          <p class="value" id="total-revenue">$0</p>
        </div>
        <div class="stat-card">
          <h3>Low Stock Items</h3>
          <p class="value" id="low-stock" style="color: var(--danger);">0</p>
        </div>
      </div>

      <!-- Recent Orders -->
      <div class="admin-card mb-4">
        <h3 style="margin-bottom: 1rem;">Recent Orders</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="recent-orders">
            <tr><td colspan="5" style="text-align: center; color: var(--gray);">No orders yet</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Low Stock Products -->
      <div class="admin-card">
        <h3 style="margin-bottom: 1rem;">Low Stock Alert</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Category</th>
              <th>Stock</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="low-stock-products">
            <tr><td colspan="4" style="text-align: center; color: var(--gray);">All products are well stocked</td></tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <script src="../js/data.js"></script>
  <script>
    // Check admin auth
    if (!isAdminLoggedIn()) {
      window.location.href = 'login.html';
    }

    function adminLogout() {
      setAdminLoggedIn(false);
      window.location.href = 'login.html';
    }

    function loadDashboard() {
      const products = getProducts();
      const orders = getOrders();
      
      // Stats
      document.getElementById('total-products').textContent = products.length;
      document.getElementById('total-orders').textContent = orders.length;
      
      const revenue = orders.reduce((sum, o) => sum + o.total, 0);
      document.getElementById('total-revenue').textContent = `$${revenue.toFixed(2)}`;
      
      const lowStock = products.filter(p => p.stock < 10);
      document.getElementById('low-stock').textContent = lowStock.length;
      
      // Recent Orders
      const recentOrders = orders.slice(-5).reverse();
      const ordersTable = document.getElementById('recent-orders');
      
      if (recentOrders.length > 0) {
        const users = getUsers();
        ordersTable.innerHTML = recentOrders.map(order => {
          const user = users.find(u => u.id === order.userId);
          return `
            <tr>
              <td>${order.id}</td>
              <td>${user ? user.name : 'Unknown'}</td>
              <td>$${order.total.toFixed(2)}</td>
              <td><span class="status-badge status-${order.status === 'confirmed' ? 'active' : 'pending'}">${order.status}</span></td>
              <td>${new Date(order.createdAt).toLocaleDateString()}</td>
            </tr>
          `;
        }).join('');
      }
      
      // Low Stock
      const lowStockTable = document.getElementById('low-stock-products');
      if (lowStock.length > 0) {
        lowStockTable.innerHTML = lowStock.map(p => `
          <tr>
            <td style="display: flex; align-items: center; gap: 0.5rem;">
              <img src="${p.images[0]}" class="product-thumb" alt="${p.name}">
              ${p.name.substring(0, 30)}...
            </td>
            <td>${p.category}</td>
            <td>${p.stock}</td>
            <td><span class="status-badge ${p.stock === 0 ? 'status-inactive' : 'status-pending'}">${p.stock === 0 ? 'Out of Stock' : 'Low Stock'}</span></td>
          </tr>
        `).join('');
      }
    }

    document.addEventListener('DOMContentLoaded', loadDashboard);
  </script>
</body>
</html>
