<!-- Replace the script section at the bottom of index.html -->
<script src="js/data.js"></script>
<script src="js/app.js"></script>
<script>
  // Render Age Groups
  function renderAgeGroups() {
    const container = document.getElementById('age-groups-grid');
    const icons = ['ðŸ‘¶', 'ðŸ¼', 'ðŸš¼', 'ðŸ§’', 'ðŸ‘¦', 'ðŸŽ’'];
    
    container.innerHTML = AGE_GROUPS.map((ag, index) => `
      <a href="products.html?ageGroup=${ag.id}" class="category-card">
        <div style="font-size: 3rem; margin-bottom: 1rem;">${icons[index]}</div>
        <h3>${ag.label}</h3>
        <p>Shop Now</p>
      </a>
    `).join('');
  }

  // Render Categories
  function renderCategories() {
    const container = document.getElementById('categories-grid');
    
    container.innerHTML = CATEGORIES.map(cat => `
      <a href="products.html?category=${cat.id}" class="category-card">
        <div style="font-size: 3rem; margin-bottom: 1rem;">${cat.icon}</div>
        <h3>${cat.name}</h3>
        <p>${cat.description}</p>
      </a>
    `).join('');
  }

  // Render Featured Products from MongoDB
  async function renderFeaturedProducts() {
    const container = document.getElementById('featured-products');
    container.innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="loading-spinner" style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #6366f1; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div><p style="margin-top: 1rem; color: var(--gray);">Loading products...</p></div><style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>';
    
    try {
      const products = await getProducts({ featured: 'true' });
      
      if (products.length === 0) {
        // If no featured, get all products
        const allProducts = await getProducts();
        container.innerHTML = allProducts.slice(0, 4).map(p => renderProductCard(p)).join('');
      } else {
        container.innerHTML = products.slice(0, 4).map(p => renderProductCard(p)).join('');
      }
    } catch (error) {
      console.error('Error loading featured products:', error);
      container.innerHTML = '<p style="text-align: center; color: var(--gray);">Failed to load products. Please refresh.</p>';
    }
  }

  // Render New Arrivals from MongoDB
  async function renderNewArrivals() {
    const container = document.getElementById('new-arrivals');
    container.innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="loading-spinner" style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #6366f1; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div></div>';
    
    try {
      const products = await getProducts();
      
      // Sort by createdAt and get newest
      const sorted = products.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      container.innerHTML = sorted.slice(0, 4).map(p => renderProductCard(p)).join('');
    } catch (error) {
      console.error('Error loading new arrivals:', error);
      container.innerHTML = '<p style="text-align: center; color: var(--gray);">Failed to load products.</p>';
    }
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', async () => {
    renderAgeGroups();
    renderCategories();
    await renderFeaturedProducts();
    await renderNewArrivals();
  });
</script>
